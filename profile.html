<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanfiat Technologies - Profile</title>
    <meta name="description" content="Sanfiat Technologies offers top-notch products and services advertising.">
    <meta property="og:title" content="Sanfiat Technologies">
    <meta property="og:description" content="Leading provider of products and services advertisment.">
    <meta property="og:image" content=images/Photo_1723191951676.png">
    <meta property="og:url" content="https://www.sanfiat-technologies.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="icon" href="images/Photo_1723191951676.png" type="image/x-icon">
    </head>
    <header>
    <a href="index.html">
        <img id="logo" src="images/Photo_1723191951676.png" alt="Logo">
    </a>
      <div class="notification-icon">
    <a href="notifications.html">
        <i class="fas fa-bell" style="font-size: 30px;"></i>
        <span class="notification-count" id="notification-count">1</span>
    </a>
</div>
<button id="hamburger-icon" class="hamburger-menu">
    <i class="fas fa-bars" style="font-size: 30px;"></i>
</button>
        <nav id="mobile-nav" class="mobile-nav">
           <a href="index.html">
        <img id="logo" src="images/Photo_1723191951676.png" alt="Logo">
           </a>
    <h3>Main Categories</h3>
<a href="dashboard.html" class="has-submenu">
    <i class="fas fa-tachometer-alt"></i> Dashboard
</a>

<a href="packages.html" class="has-submenu">
    <i class="fas fa-box-open"></i> Packages
</a>
<div class="submenu">
    <a href="packages.html"><i class="fas fa-box"></i> Basic</a>
    <a href="packages.html"><i class="fas fa-boxes"></i> Premium</a>
</div>

<a href="deposit.html" class="has-submenu">
    <i class="fas fa-wallet"></i> Deposit
</a>
<div class="submenu">
    <a href="deposit.html"><i class="fas fa-mobile-alt"></i> MPESA</a>
    <a href="deposit.html"><i class="fab fa-paypal"></i> PayPal</a>
</div>

<a href="withdraw.html" class="has-submenu">
    <i class="fas fa-hand-holding-usd"></i> Withdraw
</a>
<div class="submenu">
    <a href="withdrawal.html"><i class="fas fa-mobile-alt"></i> MPESA</a>
    <a href="withdrawal.html"><i class="fas fa-university"></i> Bank Transfer</a>
</div>
            

<h3>Other Categories</h3>
<a href="products.html">
    <i class="fas fa-box"></i> Products
</a>
<a href="whatsapp-earnings.html">
    <i class="fab fa-whatsapp"></i> WhatsApp Earnings
</a>
<a href="bonuses.html">
    <i class="fas fa-gift"></i> Bonuses
</a>
<a href="loans.html">
    <i class="fas fa-money-check-alt"></i> Loans
</a>
<a href="vip.html">
    <i class="fas fa-crown"></i> VIP
</a>
<a href="vvip.html">
    <i class="fas fa-gem"></i> VVIP
</a>
<a href="blog.html">
    <i class="fas fa-blog"></i> Blog
</a>
<a href="profile.html">
    <i class="fas fa-user"></i> Profile
</a>
<a href="notifications.html">
    <i class="fas fa-bell"></i> Notifications
</a>
<a href="reviews.html">
    <i class="fas fa-star"></i> Reviews
</a>
<button type="button" id="logout-button">
    <i class="fas fa-sign-out-alt"></i> Log Out
        </button>
        </nav>
 </header>
<body>
<div class="profile-container">
        <!-- Profile Picture, Follow, and Message Buttons -->
        <div class="profile-header">
            <div class="profile-picture">
                <img id="profile-pic" src="default-profile.png" alt="Profile Picture"> <!-- Default picture -->
                <input type="file" id="profile-pic-input" style="display: none;">
                <button id="upload-pic-btn">Change Profile Picture</button>
            </div>
            <div class="profile-actions">
                <button id="follow-btn"><i class="fas fa-user-plus"></i> Follow</button>
                <button id="message-btn"><i class="fas fa-envelope"></i> Message</button>
            </div>
        </div>

        <!-- User Info -->
        <div class="profile-details">
            <div class="info-box" id="name-box">
                <span class="info-icon"><i class="fas fa-user"></i></span>
                <p><strong>Name:</strong> <span id="user-name">Loading...</span></p>
            </div>
            <div class="info-box" id="email-box">
                <span class="info-icon"><i class="fas fa-envelope"></i></span>
                <p><strong>Email:</strong> <span id="email">Loading...</span> <button class="copy-btn" id="copy-email-btn">Copy</button></p>
            </div>
            <div class="info-box" id="phone-box" style="color: black;">
                <span class="info-icon"><i class="fas fa-phone"></i></span>
                <p><strong>Phone Number:</strong> <span id="phone-number">Loading...</span></p>
            </div>
            <div class="info-box" id="referral-box">
                <span class="info-icon"><i class="fas fa-link"></i></span>
                <p><strong>Referral Link:</strong> <span id="referral-link">Loading...</span> <button class="copy-btn" id="copy-referral-btn">Copy</button></p>
            </div>
            <div class="info-box" id="referral-by-box" style="color: black;">
                <span class="info-icon"><i class="fas fa-users"></i></span>
                <p><strong>Referred By:</strong> <span id="referral-by">Loading...</span></p>
            </div>
        </div>
                       </div>
    
    <footer>
    <div class="footer">
        <div class="footer-item">
            <a href="dashboard.html">
                <i class="fas fa-home footer-icon"></i>
                <span>Home</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="deposit.html">
                <i class="fas fa-money-bill-alt footer-icon"></i> <!-- Changed to a money icon for deposit -->
                <span>Deposit</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="packages.html">
                <i class="fas fa-box-open footer-icon"></i> <!-- Changed to a box open icon for packages -->
                <span>Packages</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="dashboard.html">
                <i class="fas fa-tachometer-alt footer-icon"></i>
                <span>Dashboard</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="profile.html">
                <i class="fas fa-user-circle footer-icon"></i> <!-- Changed to a user circle icon for profile -->
                <span>Profile</span>
            </a>
        </div>
    </div>
    
    <div class="Button">
        <a href="deposit.html">
            <p class="post-btn">
                <i class="fa fa-plus-square"></i>
            </p>
        </a>
    </div>
    </footer>
    <script>
// Get DOM elements
const profilePic = document.getElementById('profile-pic');
const profilePicInput = document.getElementById('profile-pic-input');
const uploadPicBtn = document.getElementById('upload-pic-btn');
const userName = document.getElementById('user-name');
const fullName = document.getElementById('full-name');
const email = document.getElementById('email');
const phoneNumber = document.getElementById('phone-number');
const referralBy = document.getElementById('referral-by');
const referralLink = document.getElementById('referral-link');
const copyEmailBtn = document.getElementById('copy-email-btn');
const copyReferralBtn = document.getElementById('copy-referral-btn');

// Function to load user profile from Firestore
const loadUserProfile = async (userId) => {
    const userDoc = await db.collection('users').doc(userId).get();
    if (userDoc.exists) {
        const userData = userDoc.data();
        const userFullName = `${userData.firstName} ${userData.lastName}`;
        userName.innerText = userFullName;
        email.innerText = `${userData.email.slice(0, 15)}...`; // Show part of the email
        phoneNumber.innerText = userData.phoneNumber || 'N/A';
        referralBy.innerText = userData.referralBy || 'N/A';
        referralLink.innerText = `${userData.referralLink.slice(0, 15)}...`; // Show part of referral link

        // Load profile picture if available
        if (userData.profilePicUrl) {
            profilePic.src = userData.profilePicUrl;
        }
    } else {
        console.log('No user data found');
    }
};

// Check if the user is logged in
auth.onAuthStateChanged((user) => {
    if (user) {
        // User is signed in, get the user ID (UID)
        const userId = user.uid;

        // Load the user profile using their UID
        loadUserProfile(userId);
    } else {
        // No user is signed in, redirect to login page or show a message
        console.log('User not signed in');
        window.location.href = 'login.html'; // Redirect to login page
    }
});

// Profile picture upload functionality
uploadPicBtn.addEventListener('click', () => {
    profilePicInput.click(); // Trigger file input
});

profilePicInput.addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (file) {
        const user = auth.currentUser; // Get the current logged-in user
        if (user) {
            const userId = user.uid; // Get the UID
            const storageRef = storage.ref(`profilePictures/${userId}`);
            await storageRef.put(file); // Upload the file to Firebase Storage
            const downloadURL = await storageRef.getDownloadURL();

            // Update Firestore with the new profile picture URL
            await db.collection('users').doc(userId).update({
                profilePicUrl: downloadURL
            });

            profilePic.src = downloadURL; // Update the profile picture on the page
        }
    }
});

// Copy email and referral link functionality
const copyToClipboard = (text) => {
    navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
    }).catch((err) => {
        console.error('Could not copy text: ', err);
    });
};

copyEmailBtn.addEventListener('click', () => {
    copyToClipboard(email.innerText);
});

copyReferralBtn.addEventListener('click', () => {
    copyToClipboard(referralLink.innerText);
});
</script>

    <p class="copyright-text">&copy; 2024 Sanfiat Technologies. All rights reserved.</p>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js"></script>
    
    <!-- Your custom script using Firebase -->
    <script type="module" src="script.js"></script>
</body>
</html>
