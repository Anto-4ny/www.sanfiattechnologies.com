<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanfiat Technologies - My Dashboard</title>
    <meta name="description" content="Sanfiat Technologies offers top-notch products and services advertising.">
    <meta property="og:title" content="Sanfiat Technologies">
    <meta property="og:description" content="Leading provider of products and services advertisment.">
    <meta property="og:image" content=images/Photo_1723191951676.png">
    <meta property="og:url" content="https://www.sanfiat-technologies.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="icon" href="images/Photo_1723191951676.png" type="image/x-icon">
<style>
    /* Style for the pop-up modal */
.popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent background */
    display: flex;
    justify-content: center;
    align-items: center;
     z-index: 1000; 
}

.popup-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    width: 100%;
    max-width: 400px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
}

.activate-btn, .pay-btn {
    background-color: #28a745;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
}

.activate-btn:hover, .pay-btn:hover {
    background-color: #218838;
}

input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 4px;
    border: 1px solid #ccc;
}
    </style>
</head>
    <header>
    <a href="index.html">
        <img id="logo" src="images/Photo_1723191951676.png" alt="Logo">
    </a>
      <div class="notification-icon">
    <a href="notifications.html">
        <i class="fas fa-bell" style="font-size: 30px;"></i>
        <span class="notification-count" id="notification-count">1</span>
    </a>
</div>
<button id="hamburger-icon" class="hamburger-menu">
    <i class="fas fa-bars" style="font-size: 30px;"></i>
</button>
        <nav id="mobile-nav" class="mobile-nav">
           <a href="index.html">
        <img id="logo" src="images/Photo_1723191951676.png" alt="Logo">
           </a>
    <h3>Main Categories</h3>
<a href="dashboard.html" class="has-submenu">
    <i class="fas fa-tachometer-alt"></i> Dashboard
</a>

<a href="packages.html" class="has-submenu">
    <i class="fas fa-box-open"></i> Packages
</a>
<div class="submenu">
    <a href="packages.html"><i class="fas fa-box"></i> Basic</a>
    <a href="packages.html"><i class="fas fa-boxes"></i> Premium</a>
</div>

<a href="deposit.html" class="has-submenu">
    <i class="fas fa-wallet"></i> Deposit
</a>
<div class="submenu">
    <a href="deposit.html"><i class="fas fa-mobile-alt"></i> MPESA</a>
    <a href="deposit.html"><i class="fab fa-paypal"></i> PayPal</a>
</div>

<a href="withdraw.html" class="has-submenu">
    <i class="fas fa-hand-holding-usd"></i> Withdraw
</a>
<div class="submenu">
    <a href="withdrawal.html"><i class="fas fa-mobile-alt"></i> MPESA</a>
    <a href="withdrawal.html"><i class="fas fa-university"></i> Bank Transfer</a>
</div>
            

<h3>Other Categories</h3>
<a href="products.html">
    <i class="fas fa-box"></i> Products
</a>
<a href="whatsapp-earnings.html">
    <i class="fab fa-whatsapp"></i> WhatsApp Earnings
</a>
<a href="bonuses.html">
    <i class="fas fa-gift"></i> Bonuses
</a>
<a href="loans.html">
    <i class="fas fa-money-check-alt"></i> Loans
</a>
<a href="vip.html">
    <i class="fas fa-crown"></i> VIP
</a>
<a href="vvip.html">
    <i class="fas fa-gem"></i> VVIP
</a>
<a href="blog.html">
    <i class="fas fa-blog"></i> Blog
</a>
<a href="profile.html">
    <i class="fas fa-user"></i> Profile
</a>
<a href="notifications.html">
    <i class="fas fa-bell"></i> Notifications
</a>
<a href="reviews.html">
    <i class="fas fa-star"></i> Reviews
</a>
<button type="button" id="logout-button">
    <i class="fas fa-sign-out-alt"></i> Log Out
        </button>
        </nav>
    </header>                         
    <body>
  <div id="payment-popup" class="popup">
    <div class="popup-content">
        <h2>Activate Your Account</h2>
        <p>Your account needs to be activated to access all features.</p>
        <button id="activate-btn" class="activate-btn">Activate Account</button>
        <div id="payment-section" class="payment-section" style="display: none;">
            <label for="phone-number">Enter your MPESA Number:</label>
            <input type="text" id="phone-number" placeholder="07XXXXXXXX" required>
            <label for="amount">Amount:</label>
            <input type="text" id="amount" value="250" readonly>
            <button id="pay-btn" class="pay-btn">Pay Now</button>
        </div>
    </div>
</div>

<section id="dashboard">
            <div id="dashboard-section">
                <section class="dashboard-welcome-box">
                    <h1>Welcome back <span id="firstName"></span></h1>
                        <!-- Notification Bar -->
<div id="notification-bar">
    Cashback Offers Activated Successfully: Purchase Standard package @2,800 Receive 5,600KES Cashback, Purchase Ultimate package @6,000 Receive 12,000KES Cashback bonus. All Cashbacks are instant!
    <span class="close-btn" id="close-notification">&times;</span>
</div>
               <h2>Dashboard</h2>     
                </section>
                
                <div id="user-info">
    <div class="info-box">
        <p> Name: <span id="firstName"></span></p> <!-- Added first name element -->
    </div>
    <div class="info-box">
        <p>Email: <span id="user-email"></span></p>
    </div>
    <div class="info-box">
        <p>Referrals: <span id="referral-count"></span></p>
    </div>
    <div class="info-box">
        <p>Total Views: <span id="total-views"></span></p>
    </div>
    <div class="info-box">
        <p>Total Earnings: <span id="total-earnings"></span> Ksh</p>
    </div>
    <div class="info-box">
        <p>Amount Deposited: <span id="amount-paid">0</span> Ksh</p>
    </div>
    <div class="info-box">
        <p>Packages: <span id="package-status"></span></p> <!-- Added package status element -->
    </div>
                </div>
                
    <div id="referral-link-section">
    <h3>Your Referral Link</h3>
    <p id="referral-link"></p>
    <button id="copy-link-button">Copy Link</button>
    <a id="whatsapp-share-button" href="#" target="_blank" aria-label="Share on WhatsApp">
        <img src="images/waicon.jpg" alt="Share on WhatsApp" style="width: 30px; vertical-align: middle;">
        Share on WhatsApp
    </a>
    </div>

    <div id="referrals-section">
    <h3>Referred Users</h3>
    <ul id="referral-list">
        <!-- Referred users will be listed here -->
    </ul>
    </div>
    
    
</section>
<footer>
    <div class="footer">
    <div class="footer-item">
        <a href="#home">
            <img src="images/home.png" alt="Home Icon" class="footer-icon">
            <span>Home</span>
        </a>
    </div>
    <div class="footer-item">
        <a href="#login">
            <img src="images/images.png" alt="Login Icon" class="footer-icon">
            <span>Log in</span>
        </a>
    </div>
    <div class="footer-item">
        <a href="#register">
            <img src="images/images.jpeg" alt="Register Icon" class="footer-icon">
            <span>Register</span>
        </a>
    </div>
    <div class="footer-item">
        <a href="dashboard.html">
            <img src="images/dashboard .png" alt="Dashboard Icon" class="footer-icon">
            <span>Dashboard</span>
        </a>
    </div>
    <div class="footer-item">
        <a href="htmls/purchase-a-package.html">
            <img src="images/packages.png" alt="Packages Icon" class="footer-icon">
            <span>Packages</span>
        </a>
    </div>
    </div>
    
    <div class="Button">
        <a href="deposit.html">
            <p class="post-btn">
                <i class="fa fa-plus-square"></i>
            </p>
        </a>
    </div>
</footer>
        <script>
        // Function to check if the user has paid
const checkUserPaymentStatus = async () => {
    const userId = localStorage.getItem('userId');  // Assuming userId is stored after login
    if (!userId) {
        return false;  // No user logged in
    }

    const userDoc = await firestore.collection('users').doc(userId).get();
    if (userDoc.exists && userDoc.data().paymentStatus) {
        return true;  // User has paid
    } else {
        return false;  // User has not paid
    }
};

// Redirect user based on payment status
document.addEventListener('DOMContentLoaded', async () => {
    const hasPaid = await checkUserPaymentStatus();
    if (!hasPaid) {
        showPaymentPopup();
    }
});

// Function to show the payment popup
const showPaymentPopup = () => {
    const popup = document.getElementById('payment-popup');
    popup.style.display = 'block';
    
    // Hide the payment section initially
    const paymentSection = document.getElementById('payment-section');
    paymentSection.style.display = 'none';

    // Show the payment section and pay button after clicking "Activate Account"
    const activateButton = document.getElementById('activate-btn');
    activateButton.addEventListener('click', () => {
        paymentSection.style.display = 'block'; // Show payment section
    });

    // Handle pay button click and initiate MPESA payment
    const payButton = document.getElementById('pay-btn');
    payButton.addEventListener('click', () => {
        const phoneNumber = document.getElementById('phone-number').value; // Corrected ID

        if (phoneNumber) {
            // Call the backend to initiate the MPESA payment
            fetch('/initiate-payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    phoneNumber: phoneNumber,
                    amount: 250 // Amount to pay
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("MPESA payment initiated. Please check your phone.");
                } else {
                    alert("Payment failed: " + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        } else {
            alert("Please enter your MPESA phone number.");
        }
    });
};
    </script>
    
        <p class="copyright-text">&copy; 2024 Sanfiat Technologies. All rights reserved.</p>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js"></script>
    
    <!-- Your custom script using Firebase -->
    <script type="module" src="script.js"></script>
</body>
</html>
