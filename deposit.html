<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sanfiat Technologies - deposit</title>
    <meta name="description" content="Sanfiat Technologies offers top-notch products and services advertising.">
    <meta property="og:title" content="Sanfiat Technologies">
    <meta property="og:description" content="Leading provider of products and services advertisment.">
    <meta property="og:image" content=images/Photo_1723191951676.png">
    <meta property="og:url" content="https://www.sanfiat-technologies.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="icon" href="images/Photo_1723191951676.png" type="image/x-icon">
       <!--  <script>
    if (localStorage.getItem('paymentStatus') !== 'paid') {
    window.location.href = 'dashboard.html'; // Redirect to the payment page
}
</script>-->
<style>
        /* Basic styling, adjust as needed */
        .hidden { display: none; }
        .show { display: block; }
        .password-toggle { cursor: pointer; }
        #payment-section { margin-top: 20px; }
        .message { color: red; }
    </style>
    <div id="deposit-header" onclick="window.location.href='deposit.html'">
    Deposit
</div
</head>
   <header>
  <a href="index.html">
    <img id="logo" src="images/Photo_1723191951676.png" alt="Logo">
  </a>

  <div class="notification-icon">
    <a href="notifications.html">
      <i class="fas fa-bell"></i>
      <span class="notification-count" id="notification-count">1</span>
    </a>
  </div>

  <div class="profile-icon">
    <a href="profile.html">
      <i class="fas fa-user-circle"></i>
    </a>
  </div>

  <button id="hamburger-icon" class="hamburger-menu">
    <i class="fas fa-bars"></i>
  </button>
</header>
    <div id="balance-section">
    <i class="fas fa-wallet"></i>
    <span>Balance: 0 Ksh</span>
        </div>

<div id="overlay"></div>

<nav id="mobile-nav" class="mobile-nav">
  <h3>Main Categories</h3>
  <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
  <a href="#" class="has-submenu"><i class="fas fa-box-open"></i> Packages</a>
  <div class="submenu">
    <a href="packages.html"><i class="fas fa-box"></i> Basic</a>
    <a href="packages.html"><i class="fas fa-boxes"></i> Premium</a>
  </div>
  <a href="deposit.html"><i class="fas fa-wallet"></i> Deposit</a>
  <a href="withdrawal.html"><i class="fas fa-hand-holding-usd"></i> Withdraw</a>
  <h3>Other Categories</h3>
  <a href="product.html"><i class="fas fa-box"></i> Products</a>
  <a href="whatsapp-earnings.html"><i class="fab fa-whatsapp"></i> WhatsApp Earnings</a>
  <a href="welcome-bonuses.html"><i class="fas fa-gift"></i> Welcome Bonus</a>
  <a href="cashback-bonuses.html"><i class="fas fa-coins"></i> Cashback Bonus</a>
  <a href="loans.html"><i class="fas fa-money-check-alt"></i> Loans</a>
  <a href="profile.html"><i class="fas fa-user"></i> Profile</a>
  <button type="button" id="logout-button"><i class="fas fa-sign-out-alt"></i> Log Out</button>
</nav>
<main>

  <!-- Payment Section -->
  <div id="payment-section" style="
      width: 90%;
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      background-color: #f9f9f9;
      font-family: Arial, sans-serif;
    ">
    <h3 style="
        text-align: center;
        color: #4CAF50;
        margin-bottom: 15px;
        font-size: 1.5em;
      ">
      Make a Payment
    </h3>

    <img src="images/Icons/images.jpeg" alt="MPESA Logo" style="
        display: block;
        margin: 0 auto 20px;
        width: 80px;
        height: auto;
      ">

    <p style="
        font-size: 0.9em;
        color: #555;
        text-align: center;
      ">
      To complete your payment via MPESA, follow the steps below:
    </p>

    <ol style="padding-left: 15px; font-size: 0.9em; color: #444;">
      <li>Enter your phone number and amount below.</li>
      <li>Click the "Deposit" button.</li>
      <li>A pop-up will prompt you for your MPESA PIN.</li>
      <li>Copy and paste the transaction code below.</li>
    </ol>

    <!-- Phone Number Input -->
    <label for="phone-number" style="display: block; margin-top: 10px; font-weight: bold;">Enter Your Phone Number:</label>
    <input type="text" id="phone-number" placeholder="07XX XXX XXX" style="
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      ">

    <!-- Suggested Amounts -->
    <div style="margin: 15px 0;">
      <p style="font-weight: bold;">Select an Amount:</p>
      <div style="
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
        ">
        <button type="button" class="amount-suggestion" style="
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
          " onclick="setAmount(500)">500</button>
        <button class="amount-suggestion" onclick="setAmount(250)">250</button>
        <button class="amount-suggestion" onclick="setAmount(680)">680</button>
        <button class="amount-suggestion" onclick="setAmount(900)">900</button>
        <button class="amount-suggestion" onclick="setAmount(6000)">6000</button>
        <button class="amount-suggestion" onclick="setAmount(1000)">1000</button>
      </div>
    </div>

    <!-- Amount Input -->
    <label for="amount" style="display: block; font-weight: bold;">Enter Amount to Deposit:</label>
    <input type="number" id="amount" placeholder="e.g. 500" style="
        width: 100%;
        padding: 8px;
        margin: 5px 0 15px 0;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      ">

    <!-- Pay Button -->
    <button id="pay-button" style="
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #4CAF50;
        color: white;
        font-size: 1em;
        cursor: pointer;
        margin-bottom: 15px;
      ">
     Deposit <span id="package-amount"></span>
    </button>

    <!-- MPESA Code Input -->
    <label for="payment-confirmation" style="display: block; font-weight: bold;">Enter MPESA Code:</label>
    <input type="text" id="payment-confirmation" placeholder="MPESA Transaction Code" style="
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      ">

    <!-- Submit Payment Button -->
    <button id="submit-payment" style="
        width: 100%;
        margin-top: 15px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #2196F3;
        color: white;
        font-size: 1em;
        cursor: pointer;
      ">
      Submit Payment Code
    </button>

    <p id="payment-status" style="margin-top: 15px; text-align: center; color: red;"></p>
  </div>

  <!-- Confirmation Section -->
  <div id="confirmation-section" style="
      width: 90%;
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      background-color: #f9f9f9;
      font-family: Arial, sans-serif;
    ">
    <h3 style="
        text-align: center;
        color: #4CAF50;
        font-size: 1.5em;
      ">
      Business Payment Details
    </h3>
    <p style="text-align: center; font-size: 1.1em;">
      <strong>Till Number:</strong> 4904474
    </p>

    <!-- MPESA Code Confirmation -->
    <label for="confirm-mpesa-code" style="display: block; margin-top: 10px; font-weight: bold;">
      Enter MPESA Code:
    </label>
    <input type="text" id="confirm-mpesa-code" placeholder="MPESA Transaction Code" style="
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      ">

    <button id="submit-confirmation" style="
        width: 100%;
        margin-top: 15px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background-color: #2196F3;
        color: white;
        font-size: 1em;
        cursor: pointer;
      ">
      Submit Payment Code
    </button>
  </div>
    </main>
      
    <footer>
    <div class="footer">
        <div class="footer-item">
            <a href="dashboard.html">
                <i class="fas fa-home footer-icon"></i>
                <span>Home</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="deposit.html">
                <i class="fas fa-money-bill-alt footer-icon"></i> <!-- Changed to a money icon for deposit -->
                <span>Deposit</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="packages.html">
                <i class="fas fa-box-open footer-icon"></i> <!-- Changed to a box open icon for packages -->
                <span>Packages</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="dashboard.html">
                <i class="fas fa-tachometer-alt footer-icon"></i>
                <span>Dashboard</span>
            </a>
        </div>
        <div class="footer-item">
            <a href="profile.html">
                <i class="fas fa-user-circle footer-icon"></i> <!-- Changed to a user circle icon for profile -->
                <span>Profile</span>
            </a>
        </div>
    </div>
    
    <div class="Button">
        <a href="deposit.html">
            <p class="post-btn">
                <i class="fa fa-plus-square"></i>
            </p>
        </a>
    </div>
    </footer>
    
        <p class="copyright-text">&copy; 2024 Sanfiat Technologies. All rights reserved.</p>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js"></script>

    <!-- Your custom script using Firebase -->
    <script type="module" src="script.js"></script>
    
    <script>
    // Extract package info from query params
    function getQueryParams() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const packageName = urlParams.get('packageName');
        const packagePrice = urlParams.get('packagePrice');
        
        if (packagePrice) {
            document.getElementById('package-amount').textContent = `${packagePrice} Ksh`;
            document.getElementById('amount').value = packagePrice;
        }

        return { packageName, packagePrice };
    }

    // Fetch user email
    const getUserEmail = async () => {
        const user = auth.currentUser;
        if (user) {
            return user.email;
        } else {
            console.error('No logged-in user found.');
            return null;
        }
    };

    // Handle payment
    document.getElementById("pay-button").addEventListener("click", async function() {
        const phoneNumber = document.getElementById("phone-number").value.trim();
        const amount = document.getElementById("amount").value.trim();
        const email = await getUserEmail();

        if (phoneNumber.match(/^07\d{8}$/) && amount > 0 && email) {
            try {
                const response = await fetch('https://www-sanfiattechnologies-com.vercel.app/api/pay', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phoneNumber, amount, email })
                });

                const result = await response.json();

                if (response.ok) {
                    alert(result.message);
                    sessionStorage.setItem('paymentId', result.paymentId);
                } else {
                    alert('Payment failed. ' + result.error);
                }
            } catch (error) {
                console.error('Error initiating payment:', error);
                alert('Payment initiation error. Try again.');
            }
        } else {
            alert('Invalid phone number or amount.');
        }
    });

    // Handle payment code submission
    document.getElementById("submit-payment").addEventListener("click", async function() {
        const paymentCode = document.getElementById("payment-confirmation").value.trim();
        const paymentId = sessionStorage.getItem('paymentId');

        if (paymentCode && paymentId) {
            try {
                const response = await fetch(`/api/payments/${paymentId}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mpesaCode: paymentCode })
                });

                const result = await response.json();
                if (response.ok) {
                    document.getElementById("payment-status").textContent = "Payment confirmed.";
                } else {
                    alert('Payment update failed. ' + result.error);
                }
            } catch (error) {
                console.error('Error updating payment:', error);
                alert('Error updating payment. Try again.');
            }
        } else {
            alert('Please enter the MPESA transaction code.');
        }
    });

    // Run on page load
    const packageInfo = getQueryParams();
</script>

    
</body>
                            </html>
